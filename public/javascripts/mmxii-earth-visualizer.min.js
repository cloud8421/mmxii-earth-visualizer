/*! mmxii-earth-visualizer - v0.0.1 - 2012-08-04
* Copyright (c) 2012 Claudio Ortolina; Licensed  */
window.MmxiiEarth={Models:{},Collections:{},Views:{}},$(document).ready(function(){var a,b;return b=new MmxiiEarth.Collections.Tweets,new MmxiiEarth.Views.EarthPlotter,a=io.connect("http://localhost"),a.on("data",function(a){return b.add(a.source)})}),MmxiiEarth.Views.EarthPlotter=function(){function a(){var a,b=this;a={zoom:.2,position:[51.3051,-1.0543],altitude:this.defaultAltitude},this.earth=new WebGLEarth("earth-container",a),this.markersList=new MmxiiEarth.Views.MarkersList,$.subscribe("new_tweet",function(a,c){return b.markersList.add(new MmxiiEarth.Views.Marker(b.earth,c))})}return a.prototype.defaultAltitude=9592125,a}();var __bind=function(a,b){return function(){return a.apply(b,arguments)}};MmxiiEarth.Views.Marker=function(){function a(a,b){this.earth=a,this.tweet=b,this.earthMarker=this.earth.initMarker(this.tweet.interaction.geo.latitude,this.tweet.interaction.geo.longitude),this.render()}return a.prototype.template=$("#tweet-template").html(),a.prototype.render=function(){var a;return this.tweet.created_at=this.humanizeDate(this.tweet.interaction.created_at),a=Mustache.render(this.template,this.tweet),this.earthMarker.bindPopup(a,400,!1)},a.prototype.rotateToMarker=function(){return this.earth.flyTo(this.tweet.interaction.geo.latitude,this.tweet.interaction.geo.longitude),this.earthMarker.openPopup()},a.prototype.humanizeDate=function(a){var b;return b=new Date(a),moment(b).calendar()},a}(),MmxiiEarth.Views.MarkersList=function(){function a(){this.rotate=__bind(this.rotate,this),this.list=[],this.listen()}return a.prototype.started=!1,a.prototype.add=function(a){this.list.push(a);if(!this.started)return this.start()},a.prototype.start=function(){var a=this;return this.rotate(),setInterval(function(){return a.rotate()},8e3),this.started=!0},a.prototype.hide=function(){var a,b,c,d,e;d=this.list,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.earthMarker.closePopup());return e},a.prototype.listen=function(){var a=this;return $("body").on("click","#close-popups",function(){return a.hide()}).on("click","#next-marker",function(){return a.rotate()})},a.prototype.rotate=function(){var a;return this.hide(),a=this.list.shift(),this.list.push(a),a.rotateToMarker()},a}(),MmxiiEarth.Collections.Tweets=function(){function a(){this.tweets=[]}return a.prototype.add=function(a){return this.tweets.push(a),$.publish("new_tweet",a)},a}();