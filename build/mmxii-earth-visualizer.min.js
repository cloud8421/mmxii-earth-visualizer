/*! mmxii-earth-visualizer - v0.0.1 - 2012-07-29
* Copyright (c) 2012 Claudio Ortolina; Licensed  */
window.MmxiiEarth={Models:{},Collections:{},Views:{}},$(document).ready(function(){return window.tweets=new MmxiiEarth.Collections.Tweets,tweets.fetch(),window.earthPlotter=new MmxiiEarth.Views.EarthPlotter(tweets.all()),earthPlotter.plot()}),MmxiiEarth.Views.EarthPlotter=function(){function a(a){var b;this.tweets=a,b={zoom:.2,position:[51.3051,-1.0543]},this.earth=new WebGLEarth("container",b)}return a.prototype.plot=function(){var a,b,c,d,e,f=this;console.log("Plotting "+this.tweets.length+" tweets..."),this.markersList=new MmxiiEarth.Views.MarkersList,d=this.tweets,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(function(a){return f.markersList.add(new MmxiiEarth.Views.Marker(f.earth,a))}(a));return e},a}(),MmxiiEarth.Views.Marker=function(){function a(a,b){var c;this.earth=a,this.tweet=b,this.earthMarker=(c=this.earth).initMarker.apply(c,this.tweet.geo.coordinates),this.render()}return a.prototype.template=$("#tweet-template").html(),a.prototype.render=function(){var a;return a=Mustache.render(this.template,this.tweet),this.earthMarker.bindPopup(a)},a}(),MmxiiEarth.Views.MarkersList=function(){function a(){this.list=[],this.listen()}return a.prototype.add=function(a){return this.list.push(a)},a.prototype.hide=function(){var a,b,c,d,e;d=this.list,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.earthMarker.closePopup());return e},a.prototype.listen=function(){var a=this;return $("body").on("click","#close-popups",function(){return a.hide()})},a}();var __bind=function(a,b){return function(){return a.apply(b,arguments)}};MmxiiEarth.Collections.Tweets=function(){function a(){this.fetch=__bind(this.fetch,this),this.fetch}return a.prototype.query="http://search.twitter.com/search.json?q=%23Olympics%20OR%20%23London2012%20OR%20%23Olympic&geocode=51.3051,-1.0543,10000km&rpp=100&callback=?",a.prototype.fetch=function(){return $.getJSON(this.query,function(a){var b,c,d,e,f;e=a.results,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(function(a){if(a.geo!==null)return $.jStorage.set(a.id,a)}(b));return f})},a.prototype.all=function(){var a,b,c,d,e;d=$.jStorage.index(),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push($.jStorage.get(a));return e},a}();